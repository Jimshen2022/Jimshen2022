--RM RECEIVED TIME
SELECT t1.AACOD1,t1.AACOD2,t1.AAORD#,TRIM(t1.AAITM#) AAITM#,CHAR(t1.AASER#) as SN,to_date(t1.AAADAT||' '||right('000000'||ltrim(t1.AAATIM),6), 'yyyymmdd hh24:mi:ss') as "HJ_Received_Time", t1.AAAPGM
FROM DISTLIBL.ACTAUDT t1
WHERE  t1.AAADAT Between CHAR(VARCHAR_FORMAT(current date -30 days,'YYYYMMDD'))  AND CHAR(VARCHAR_FORMAT(current date, 'YYYYMMDD'))  AND t1.AACOD1 IN ('RM')

AND NOT EXISTS
--MOVE,CN,UL
(SELECT 1
FROM 
(
SELECT CHAR(t1.AASER#) as SN
FROM DISTLIBL.ACTAUDT t1
WHERE  t1.AAADAT Between CHAR(VARCHAR_FORMAT(current date -40 days,'YYYYMMDD'))  AND CHAR(VARCHAR_FORMAT(current date, 'YYYYMMDD'))  AND t1.AACOD1 IN ('MV','CN','UL') 
GROUP BY CHAR(t1.AASER#)
) b1 
WHERE CHAR(t1.AASER#) = b1.SN)

AND EXISTS
-- MIL OPEN MO BY P&IC, Created by Jimshen on Sep.28.2021
(SELECT 1
FROM 
(SELECT * 
FROM
(
SELECT t1.STID, t1.ORDNO, t1.FITEM, t1.ORQTY+t1.QTDEV as MO_QTY, t1.QTYRC AS RECEIVED_QTY,t1.ORQTY+t1.QTDEV-t1.QTYRC AS OPEN_QTY,
t1.ODUDT,t1.ITCL, t1.JOBNO,t1.CRDT, t1.CRUS,
(CASE 
        WHEN t1.ITCL LIKE 'TAF%' THEN 'RP'
		WHEN t1.ITCL IN ('PACS') THEN 'UnKits'
        WHEN t1.ITCL LIKE 'Z%' AND t1.ITCL LIKE '%K' THEN 'UnKits'
        WHEN t1.ITCL IN ('ZACM','ZASU','ZMLH','ZMLR','ZUSR','ZUSU','ZVUC','ZXUC','ZUSU','ZUMU','ZAMU','ZASM','ZASR','ZDMA','ZMUC','ZSUS','ZUMS','ZUSM','ZVMA','ZVUS','ZXLH','ZXLM','ZXLR','ZXMS','ZXMU') THEN 'UPH'
        WHEN t1.ITCL IN ('ZDAA','ZDAY','ZVAA','ZDAB','ZDAW','ZDYB','ZDBC','ZABC','ZECD') THEN 'CG'
        WHEN t1.ITCL IN ('ZKIS') THEN 'Bedding'		
        WHEN t1.ITCL IN ('WPLS') THEN 'Plastics'
        WHEN t1.ITCL IN ('WVBC','WVCS') THEN 'Foundation'		
		WHEN t1.ITCL IN ('PANL') THEN 'Panel'
		WHEN t1.ITCL IN ('ZKIZ') THEN 'ZipperCover'
        WHEN t1.ITCL IN ('BBFR','WVHC') THEN 'Verona'		
		WHEN t1.ITCL NOT LIKE 'Z%' THEN 'Raw'
        ELSE 'Check' END) AS Product
		
FROM AMFLIBL.MOMAST t1
WHERE t1.ORQTY+t1.QTDEV <>0
AND t1.OSTAT in ('10','40','45') 
AND t1.ODUDT BETWEEN CHAR('1'||VARCHAR_FORMAT(current date - 90 Days,'YYMMDD')) AND CHAR('1'||VARCHAR_FORMAT(current date,'YYMMDD'))
ORDER BY t1.FITEM, t1.ODUDT, t1.ORDNO
) as x1  
WHERE x1.OPEN_QTY<>0) c1
WHERE t1.AAORD# = C1.ORDNO)
